<div class="card-container">
    <!-- Filtros -->
    <div class="filter-container">
        <div class="filter-group">
            <label>Orden:</label>
            <select [(ngModel)]="sortOrder" (change)="applyFilters()">
                <option value="">Ninguno</option>
                <option value="az">A - Z</option>
                <option value="za">Z - A</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Frecuencia:</label>
            <select [(ngModel)]="frequencyFilter" (change)="applyFilters()">
                <option value="">Todos</option>
                <option value="N">Nuevo</option>
                <option value="F">Cliente Fiel</option>
                <option value="O">Ocasional</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Cumpleaños:</label>
            <select [(ngModel)]="birthdayMonthFilter" (change)="applyFilters()">
                <option value="">Todos</option>
                <option *ngFor="let month of months" [value]="month.value">
                    {{ month.name }}
                </option>
            </select>
        </div>
        <div class="filter-group">
            <label>Estado:</label>
            <select [(ngModel)]="statusFilter" (change)="applyFilters()">
                <option value="">Todos</option>
                <option value="A">Activo</option>
                <option value="I">Inactivo</option>
            </select>
        </div>

        <button class="reset-btn" (click)="resetFilters()">
            <i class="fas fa-sync-alt"></i>
        </button>
    </div>

    <!-- Tarjetas -->
    <div class="cards-wrapper">
        <div class="client-card" *ngFor="let client of paginatedClients"
            [class.highlighted]="highlightedClientId === client.id">
            <div class="card-header">
                <img [src]="client.imageUrl || 'https://placehold.co/80x80'" alt="Foto Cliente" class="client-img" />
                <div class="client-basic">
                    <h3>{{ client.nameClient }} {{ client.lastname }}</h3>
                    <p>{{ client.email }}</p>
                    <span class="status" [ngClass]="{
              active: client.state === 'A',
              inactive: client.state === 'I'
            }">{{ client.state === "A" ? "Activo" : "Inactivo" }}</span>
                </div>
            </div>

            <div class="card-body">
                <p><strong>Celular:</strong> {{ client.cellphone }}</p>
                <p>
                    <strong>Cumpleaños:</strong>
                    {{ client.birthday | date: "dd/MM/yyyy" }}
                </p>
                <p>
                    <strong>Frecuencia:</strong>
                    {{
                    client.visitFrequency === "F"
                    ? "Cliente Fiel"
                    : client.visitFrequency === "O"
                    ? "Cliente Ocasional"
                    : "Cliente Nuevo"
                    }}
                </p>
            </div>

            <div class="card-actions">
                <button (click)="viewClient(client)" title="Ver">
                    <i class="fas fa-eye"></i>
                </button>
                <button *ngIf="client.state === 'A'" (click)="editClient(client)" title="Editar">
                    <i class="fa fa-edit"></i>
                </button>
                <button class="btn-toggle" (click)="toggleState(client)">
                    <i class="fa" [ngClass]="
              client.state === 'A' ? 'fa-toggle-on' : 'fa-toggle-off'
            "></i>
                </button>
                <button class="btn-more" (click)="viewClient(client)">
                    Mostrar más
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL -->
    <div class="modal" *ngIf="showModal" (click)="closeModal($event)">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <span class="close-btn" (click)="closeModal($event)">×</span>
            <h2>{{ isViewMode ? "Información del Cliente" : "Editar Cliente" }}</h2>

            <form [formGroup]="clientForm" (ngSubmit)="saveChanges()">
                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo de Documento</label>
                        <input formControlName="typeDocument" [readonly]="true" />
                    </div>
                    <div class="form-group">
                        <label>Número de Documento</label>
                        <input formControlName="numberDocument" [readonly]="true" />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Nombres</label>
                        <input formControlName="nameClient" [readonly]="isViewMode" />
                    </div>
                    <div class="form-group">
                        <label>Apellidos</label>
                        <input formControlName="lastname" [readonly]="isViewMode" />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Celular</label>
                        <input formControlName="cellphone" [readonly]="isViewMode" />
                    </div>
                    <div class="form-group">
                        <label>Fecha de Nacimiento</label>
                        <input type="date" formControlName="birthday" [readonly]="isViewMode" />
                    </div>
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <input formControlName="email" [readonly]="isViewMode" />
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Dirección</label>
                        <input formControlName="addressClient" [readonly]="isViewMode" />
                    </div>
                    <div class="form-group">
                        <label>Día de registro</label>
                        <input formControlName="registrationDate" [readonly]="true" />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Frecuencia</label>
                        <select formControlName="visitFrequency" [disabled]="isViewMode">
                            <option value="N">Cliente Nuevo</option>
                            <option value="F">Cliente Fiel</option>
                            <option value="O">Cliente Ocasional</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Estado</label>
                        <input formControlName="state" [readonly]="true" />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Imagen (URL)</label>
                        <input formControlName="imageUrl" [readonly]="isViewMode" />
                    </div>
                </div>

                <div class="button-container" *ngIf="!isViewMode">
                    <button type="submit">Actualizar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Paginación -->
    <div class="pagination-controls" *ngIf="filteredClients.length > itemsPerPage">
        <button (click)="prevPage()" [disabled]="currentPage === 1">
            <i class="fas fa-chevron-left"></i>
        </button>
        <span>Página {{ currentPage }} de {{ totalPages }}</span>
        <button (click)="nextPage()" [disabled]="currentPage === totalPages">
            <i class="fas fa-chevron-right"></i>
        </button>

        <button class="reset-btn" (click)="reportPdf()">
            <i class="fas fa-print"></i>
        </button>
    </div>
</div>
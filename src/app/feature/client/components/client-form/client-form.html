<form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-container">
    <!-- Indicador de pasos -->
    <div class="step-indicator">
        <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
            <div class="step-number">1</div>
        </div>
        <div class="step-line" [class.completed]="currentStep > 1"></div>
        <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
            <div class="step-number">2</div>
        </div>
    </div>

    <!-- PASO 1: Información Básica -->
    <div class="form-step" *ngIf="currentStep === 1">
        <h3 class="step-title">INFORMACIÓN DEL CLIENTE</h3>

        <!-- Contenedor principal con grid -->
        <div class="step-content-wrapper">
            <!-- Columna izquierda: Formulario -->
            <div class="form-fields">
                <!-- T.DOC y N° DOC -->
                <div class="form-group-row">
                    <div class="form-group">
                        <label for="documentType">T DOCUMENTO</label>
                        <select id="documentType" formControlName="documentType" (change)="onDocumentTypeChange()">
                            <option value="DNI">DNI</option>
                            <option value="CE">CE</option>
                        </select>
                        <div class="error" *ngIf="form.get('documentType')?.invalid && form.get('documentType')?.touched">
                            <span>El tipo de documento es obligatorio</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="documentNumber">N° DOCUMENTO</label>
                        <input 
                            id="documentNumber" 
                            type="text" 
                            formControlName="documentNumber" 
                            (keydown)="onlyNumbers($event)"
                            [attr.maxlength]="form.get('documentType')?.value === 'DNI' ? 8 : 20"
                            placeholder="{{form.get('documentType')?.value === 'DNI' ? '8 dígitos' : '20 dígitos'}}">
                        <div class="error" *ngIf="form.get('documentNumber')?.invalid && form.get('documentNumber')?.touched">
                            <span *ngIf="form.get('documentNumber')?.hasError('required')">El número de documento es obligatorio</span>
                            <span *ngIf="form.get('documentNumber')?.hasError('pattern')">
                                {{form.get('documentType')?.value === 'DNI' ? 'Debe tener 8 dígitos' : 'Debe tener 20 dígitos'}}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Nombres -->
                <div class="form-group">
                    <label for="firstName">NOMBRES DEL CLIENTE</label>
                    <input id="firstName" type="text" formControlName="firstName" (keydown)="onlyLetters($event)">
                    <div class="error" *ngIf="form.get('firstName')?.invalid && form.get('firstName')?.touched">
                        <span *ngIf="form.get('firstName')?.hasError('required')">Los nombres son obligatorios</span>
                        <span *ngIf="form.get('firstName')?.hasError('pattern')">Solo se permiten letras</span>
                        <span *ngIf="form.get('firstName')?.hasError('minlength')">Mínimo 3 caracteres</span>
                    </div>
                </div>

                <!-- Apellidos -->
                <div class="form-group">
                    <label for="lastName">APELLIDOS</label>
                    <input id="lastName" type="text" formControlName="lastName" (keydown)="onlyLetters($event)">
                    <div class="error" *ngIf="form.get('lastName')?.invalid && form.get('lastName')?.touched">
                        <span *ngIf="form.get('lastName')?.hasError('required')">Los apellidos son obligatorios</span>
                        <span *ngIf="form.get('lastName')?.hasError('pattern')">Solo se permiten letras</span>
                        <span *ngIf="form.get('lastName')?.hasError('minlength')">Mínimo 2 caracteres</span>
                    </div>
                </div>

                <!-- Celular y Cumpleaños -->
                <div class="form-group-row">
                    <div class="form-group">
                        <label for="phoneNumber">N° DE CELULAR</label>
                        <input 
                            id="phoneNumber" 
                            type="text" 
                            formControlName="phoneNumber" 
                            (keydown)="onlyNumbers($event)"
                            maxlength="9" 
                            placeholder="9 dígitos">
                        <div class="error" *ngIf="form.get('phoneNumber')?.invalid && form.get('phoneNumber')?.touched">
                            <span *ngIf="form.get('phoneNumber')?.hasError('required')">El celular es obligatorio</span>
                            <span *ngIf="form.get('phoneNumber')?.hasError('pattern')">Debe tener 9 dígitos y comenzar con 9</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="birthDate">FECHA DE CUMPLEAÑOS</label>
                        <div class="date-input-container">
                            <input type="date" formControlName="birthDate" [max]="maxBirthDate">
                        </div>
                        <div class="error" *ngIf="form.get('birthDate')?.invalid && form.get('birthDate')?.touched">
                            <span>Fecha de cumpleaños obligatoria</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Columna derecha: Foto de perfil -->
            <div class="photo-section">
                <p class="photo-label-top">FOTO DE PERFIL</p>
                <div class="photo-upload">
                    <img [src]="photoPreview || 'https://placehold.co/120x120'" alt="Foto de perfil" class="photo-preview">
                    <label for="photoInput" class="photo-button">
                        <i class="fas fa-camera"></i>
                    </label>
                    <input 
                        type="file" 
                        id="photoInput" 
                        accept="image/*" 
                        (change)="onPhotoSelected($event)"
                        style="display: none;">
                </div>
            </div>
        </div>

        <!-- Imagen decorativa paso 1 -->
        <div class="decorative-image">
            <img src="/paso1.png" alt="Decoración paso 1">
        </div>

        <!-- Botones Paso 1 -->
        <div class="action-buttons">
            <button type="button" class="btn-secondary" (click)="onCancel()">
                CANCELAR
            </button>
            <button type="button" class="btn-primary" (click)="nextStep()">
                SIGUIENTE →
            </button>
        </div>
    </div>

    <!-- PASO 2: Información Adicional -->
    <div class="form-step" *ngIf="currentStep === 2">
        <h3 class="step-title">INFORMACIÓN DEL CLIENTE</h3>

        <!-- Campos del paso 2 -->
        <div class="step2-fields">
            <!-- Correo Electrónico -->
            <div class="form-group">
                <label for="email">CORREO ELECTRONICO</label>
                <input id="email" type="text" formControlName="email">
                <div class="error" *ngIf="form.get('email')?.invalid && form.get('email')?.touched">
                    <span *ngIf="form.get('email')?.hasError('required')">El correo es obligatorio</span>
                    <span *ngIf="form.get('email')?.hasError('email')">El formato del correo no es válido</span>
                </div>
            </div>

            <!-- Distrito de Procedencia (Ubigeo) -->
            <div class="form-group">
                <label for="ubigeoCode">DISTRITO DE PROCEDENCIA DEL CLIENTE</label>
                <select id="ubigeoCode" formControlName="ubigeoCode">
                    <option value="">Seleccione un distrito</option>
                    <option *ngFor="let ubigeo of ubigeos" [value]="ubigeo.code">
                        {{ ubigeo.district }}
                    </option>
                </select>
                <div class="error" *ngIf="form.get('ubigeoCode')?.invalid && form.get('ubigeoCode')?.touched">
                    <span>El distrito es obligatorio</span>
                </div>
            </div>

            <!-- Frecuencia y Puntos -->
            <div class="form-group-row">
                <div class="form-group">
                    <label for="visitFrequency">FRECUENCIA DE VISITA</label>
                    <select id="visitFrequency" formControlName="visitFrequency">
                        <option value="N">Cliente Nuevo</option>
                        <option value="F">Cliente Fiel</option>
                        <option value="O">Cliente Ocasional</option>
                        <option value="H">Cliente Habitual</option>
                    </select>
                    <div class="error" *ngIf="form.get('visitFrequency')?.invalid && form.get('visitFrequency')?.touched">
                        <span>La frecuencia es obligatoria</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="points">PUNTOS DEL CLIENTE</label>
                    <input 
                        id="points" 
                        type="text" 
                        formControlName="points" 
                        (keydown)="onlyNumbers($event)"
                        placeholder="0">
                    <div class="error" *ngIf="form.get('points')?.invalid && form.get('points')?.touched">
                        <span>Los puntos son obligatorios</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Imagen decorativa paso 2 -->
        <div class="decorative-image">
            <img src="/paso2.png" alt="Decoración paso 2">
        </div>

        <!-- Botones Paso 2 -->
        <div class="action-buttons">
            <button type="button" class="btn-secondary" (click)="prevStep()">
                ← ATRAS
            </button>
            <button type="submit" class="btn-primary" [disabled]="form.invalid || isUploading">
                <span *ngIf="!isUploading">AGREGAR CLIENTE</span>
                <span *ngIf="isUploading">SUBIENDO...</span>
            </button>
        </div>
    </div>
</form>